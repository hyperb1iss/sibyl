# Sibyl - Collective Intelligence Runtime
# Root workspace configuration for dependency version management

# =============================================================================
# UV Workspace Configuration (virtual workspace - not a package)
# =============================================================================

[tool.uv]

# =============================================================================
# Version Constraints (enforced across all workspace members)
# Members use loose specs, these ensure consistent bounds
# =============================================================================
constraint-dependencies = [
    # Dev tooling
    "ruff>=0.14,<1.0",
    "pyright>=1.1,<2.0",
    "pytest>=9.0,<10.0",
    "pytest-asyncio>=1.3,<2.0",
    "pytest-cov>=7.0,<8.0",
    "pre-commit>=4.0,<5.0",
    # E2E testing
    "httpx>=0.28,<1.0",
    "playwright>=1.50,<2.0",
]

[tool.uv.workspace]
members = [
    "apps/api",
    "apps/cli",
    "apps/runner",
    "packages/python/sibyl-core",
]

# =============================================================================
# Shared Dependency Sources
# These are inherited by all workspace members
# =============================================================================

[tool.uv.sources]
# Local packages - workspace members reference each other
sibyl-core = { workspace = true }
sibyl-dev = { workspace = true }
sibyl-runner = { workspace = true }
sibyld = { workspace = true }

# =============================================================================
# Shared Tool Configuration
# =============================================================================

[tool.ruff]
line-length = 100
src = ["apps/*/src", "packages/*/src", "hooks"]

[tool.ruff.lint]
select = [
    "E", "F", "I", "UP", "B", "SIM", "RUF",
    "ASYNC", "S", "C4", "T20", "PT", "PL", "TRY",
]
ignore = [
    "E501",    # Line length (formatter handles)
    "S101",    # Assert (tests/contracts)
    "TRY003",  # Long exception messages
    "PLR0913", # Too many arguments
]

[tool.ruff.lint.per-file-ignores]
# Hooks need print for output, subprocess for CLI calls, silent failures
"hooks/*.py" = [
    "T20",     # print statements (needed for hook output)
    "S603",    # subprocess call (calling our own CLI)
    "S607",    # partial executable path (sibyl is in PATH)
    "S110",    # try-except-pass (intentional silent failures)
    "SIM105",  # contextlib.suppress (explicit try-except is clearer here)
    "PLR2004", # magic numbers (thresholds are clear in context)
]

[tool.ruff.lint.isort]
known-first-party = ["sibyl", "sibyl_core", "sibyl_cli"]

[tool.pyright]
pythonVersion = "3.13"
typeCheckingMode = "standard"
reportMissingImports = false
reportMissingTypeStubs = false

[tool.pytest.ini_options]
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"
addopts = ["-ra", "--strict-markers", "-v"]
filterwarnings = [
    "error",
    "ignore::DeprecationWarning",
    "ignore::pytest.PytestUnraisableExceptionWarning",
]
